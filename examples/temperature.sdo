StateMachine Temperature
start = InitializeTemperatureMeasurement

sleepable fork WaitForTemperatureMeasurement {
	ShouldStartMeasurement? =>
		InitializeSmoothing;
		WaitForSmoothingFinished;
}

fork WaitForSmoothingFinished {
	ShouldSmooth? && EnoughSamplesCollected? =>
		FillSharedState 
		PrepareNextMeasurementRound;
		WaitForTemperatureMeasurement;
	ShouldSmooth? =>
		SampleTemperature;
		PrepareNextSmoothStep;
		WaitForSmoothingFinished;
	default =>
		WaitForSmoothingFinished;
}